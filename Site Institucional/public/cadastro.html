<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ByteWatch | Cadastro</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="login.css">
    <link rel="icon" href="assets/logo-cd.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&display=swap" rel="stylesheet">
</head>
<body>
    
    <div class="caixa container-sm d-sm-flex flex-column position-relative" style="background-color: #fff;"> 
        
      <div class="cadastro">

          <div class="welcome row">
              <div class="bem-vindo col-md-6 mt-3 mt-sm-0" style="width: 100%;">
                      <h1><b>Bem-vindo(a)!</b></h1>
                      <p class="fs-5">Crie sua conta coorporativa por aqui!</p>
              </div>
  
              <div class="voltar position-absolute top-0 end-0 d-flex col-md-6" style="max-width: 375px; max-height: 50px; margin-top: 20px;"> <!-- mt-auto=margem superior automática-->
                      <img src="assets/seta-rosa.png">
                      <p><a href="index.html">Voltar para a página principal</a></p>
              </div>
          </div>

          <div class="cadastrar row">

                        <div class="inputs col-xl-6 mb-3 d-grid col-12">
                            <span>Nome</span> 
                            <input id="nome_input" type="text">
                        </div>
                        
                        <div class="inputs col-xl-6 mb-3 d-grid col-12">
                            <span>Código do Funcionário</span> 
                            <input id ="fk_tipo_usuario_input" type="text">
                        </div>
                        
                        <div class="inputs col-xl-6 mb-3 d-grid col-12">
                            <span>Email</span> 
                            <input id="email_input" type="text">
                        </div>
                        
                        <div class="inputs col-xl-6 mb-3 d-grid col-12">
                            <span>Senha</span> 
                            <input id="senha_input" type="password">
                        </div>
                        
                        <div class="inputs col-xl-6 mb-3 d-grid col-12">
                            <span>CPF</span> 
                            <input id="cpf_input" type="text">
                        </div> 

                        <div class="inputs col-xl-6 mb-3 d-grid col-12">
                            <span>Confirmar Senha</span> 
                            <input id="confirmacao_senha_input" type="password">
                        </div>

                        <div class="criar">
                            <div class="d-grid col-5 mx-auto">
                                <button class="btn entrar" type="button" onclick="cadastrar()">Criar</button>
                            </div>

                            <div class="mensagem align-items-center" style="min-width: 250px;">
                                <spam>Já possui uma conta? <a href="login.html">Clique aqui.</a></spam>
                            </div>
                        </div>
          </div>

      </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<script>

  // Array para armazenar empresas cadastradas para validação de código de ativação 

  function cadastrar() {
    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_input.value;
    var emailVar = email_input.value;
    var senhaVar = senha_input.value;
    var confirmacaoSenhaVar = confirmacao_senha_input.value;
    var cpfVar = cpf_input.value;
    var fk_tipo_usuarioVar = fk_tipo_usuario_input.value;

    // Verificando se há algum campo em branco
    if (
      nomeVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      confirmacaoSenhaVar == "" ||
      cpfVar == "") {
      alert('Mensagem de erro para todos os campos em branco');
      return false;
    }
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        cpfServer: cpfVar,
        fk_tipo_usuarioServer: fk_tipo_usuarioVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...");

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

</script>